<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
      name="viewport"
    />
    <meta content="ie=edge" http-equiv="X-UA-Compatible" />
    <meta name="theme-color" content="#4285f4" />
    <meta name="description" content="Luxury Distribution app for Shopify" />
    <title>Login | Luxury Distribution</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />

    <!-- Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
      integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w=="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/loadingio/loading.css@v2.0.0/dist/loading.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="//cdn.jsdelivr.net/gh/loadingio/ldbutton@v1.0.1/dist/ldbtn.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css"
      integrity="sha512-wR4oNhLBHf7smjy0K4oqzdWumd+r5/+6QO/vDda76MW5iug4PT7v86FoEkySIJft3XA0Ae6axhIvHrqwm793Nw=="
      crossorigin="anonymous"
    />

    <!-- CSS Front Template -->
    <link rel="stylesheet" type="text/css" href="/login/css/login/styles.css" />

    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-migrate/3.3.2/jquery-migrate.min.js"
      integrity="sha512-3fMsI1vtU2e/tVxZORSEeuMhXnT9By80xlmXlsOku7hNwZSHJjwcOBpmy+uu+fyWwGCLkMvdVbHkeoXdAzBv+w=="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js"
      integrity="sha512-UdIMMlVx0HEynClOIFSyOrPggomfhBKJE28LKl8yR3ghkgugPnG6iLfRfHwushZl1MOPSY6TsuBDGPK2X4zYKg=="
      crossorigin="anonymous"
    ></script>
    <style>
      .PreLoading {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background-color: #fff;
        z-index: 99999;
      }

      @keyframes Polaris-Spinner--loading {
        100% {
          transform: rotate(1turn);
        }
      }

      .PreLoading .PreLoading-Loader {
        -webkit-filter: brightness(0) saturate(100%) invert(72%) sepia(8%) saturate(2838%)
          hue-rotate(130deg) brightness(92%) contrast(87%);
        filter: brightness(0) saturate(100%) invert(72%) sepia(8%) saturate(2838%)
          hue-rotate(130deg) brightness(92%) contrast(87%);
        height: 2.5rem !important;
        width: 2.5rem !important;
        animation: Polaris-Spinner--loading 0.5s linear infinite;
        color: transparent;
      }

      .PreLoading p {
        font-weight: 700;
        font-family: -apple-system, BlinkMacSystemFont, San Francisco, Roboto, Segoe UI,
          Helvetica Neue, sans-serif;
        font-size: 1rem;
        color: #424242;
      }
    </style>
  </head>
  <body>
    <div id="PreLoading" class="PreLoading" style="display: none">
      <img width="150px" height="150px" src="/assets/mstile-310x310.png" alt="Avada logo" />
      <img
        class="PreLoading-Loader"
        src="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNDQgNDQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTE1LjU0MiAxLjQ4N0EyMS41MDcgMjEuNTA3IDAgMCAwIC41IDIyYzAgMTEuODc0IDkuNjI2IDIxLjUgMjEuNSAyMS41IDkuODQ3IDAgMTguMzY0LTYuNjc1IDIwLjgwOS0xNi4wNzJhMS41IDEuNSAwIDAgMC0yLjkwNC0uNzU2QzM3LjgwMyAzNC43NTUgMzAuNDczIDQwLjUgMjIgNDAuNSAxMS43ODMgNDAuNSAzLjUgMzIuMjE3IDMuNSAyMmMwLTguMTM3IDUuMy0xNS4yNDcgMTIuOTQyLTE3LjY1YTEuNSAxLjUgMCAxIDAtLjktMi44NjN6IiBmaWxsPSIjOTE5RUFCIi8+PC9zdmc+Cg=="
        alt="Preloading"
        draggable="false"
        role="status"
      />
      <br />
      <span class="Polaris-TextStyle--variationSubdued">
        We are logging you in. Stay tuned!
      </span>
    </div>

    <div class="wrapper" id="luxury-distribution-login-wrapper">
      <div class="content-left">
        <div class="signup-header">
          <div class="logo">
            <img src="/login/resources/logo/luxury-logo-white.svg" alt="">
          </div>
          <p>Please fill the information to sign up as a dropshipper</p>
        </div>
      </div>

      <div class="content-right">
        <div class="signup-form-wrapper" id="login-form"></div>
      </div>
    </div>

    <script src="/__/firebase/7.2.1/firebase-app.js"></script>
    <script src="/__/firebase/7.2.1/firebase-auth.js"></script>
    <script src="/__/firebase/7.2.1/firebase-analytics.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script>
      const analytics = firebase.analytics();
    </script>

    <!-- JS Plugins Init. -->
    <script>
      $(document).on('ready', function() {
        // INITIALIZATION OF SLICK CAROUSEL
        // =======================================================
        $('.js-slick-carousel').each(function() {
          var slickCarousel = $.HSCore.components.HSSlickCarousel.init($(this));
        });

        // INITIALIZATION OF FORM VALIDATION
        // =======================================================
        $('.js-validate').each(function() {
          var validation = $.HSCore.components.HSValidation.init($(this));
        });
      });
    </script>
    <script src="/login/js/authentication.js"></script>
    <script type="text/babel">
      const {useState, useEffect} = React;

      const platforms = [
        {label: 'Shopify', value: 'shopify', image: 'https://cdn1.avada.io/shopify-logo.png'},
        {label: 'Magento', value: 'magento', image: 'https://cdn1.avada.io/magento-logo.png'}
      ];
      const SELECT_PLATFORM_STEP = 1;
      const LOGIN_STEP = 2;
      const wizardSteps = [
        {label: 'Select platform', value: SELECT_PLATFORM_STEP},
        {label: 'Login', value: LOGIN_STEP}
      ];

      function handleError(setSubmitting, message) {
        setSubmitting(false);
        $('#validations-errors')
          .show()
          .html(message);
      }

      const handleManualLogin = (event, setSubmitting) => {
        event.preventDefault();
        setSubmitting(true);
        const email = $('#email').val();
        const password = $('#password').val();
        const loginBtn = $('.Avada-Login__Button');
        loginBtn.addClass('running');
        if (email.trim() === '') {
          handleError(setSubmitting, 'This email field is required');
          return;
        }
        if (password.trim() === '') {
          handleError(setSubmitting, 'This password field is required');
          return;
        }
        firebase
          .auth()
          .signInWithEmailAndPassword(email, password)
          .then(result => {
            const user = result.user;
            const {email, displayName, uid, domain, vendor} = user;

            if (user) {
              fetch('/shop/create', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  uid,
                  email,
                  name: displayName || '',
                  domain: domain || '',
                  login: true,
                  vendor: vendor || 'others'
                })
              })
                .then(response => response.json())
                .then(respData => {
                  const {shop} = respData;
                  user.getIdToken(false).then(token => {
                    window.location.replace(`/apiSa/switch/${shop}?token=${token}`);
                  });
                });
            }
          })
          .catch(function(error) {
            loginBtn.removeClass('running');
            return handleError(setSubmitting, error.message);
          });
      };
      function LoginForm({platform, setStep}) {
        const [submiting, setSubmiting] = useState(false);
        const [shopifyURL, setShopifyURL] = useState('');
        const [input, setInput] = useState([]);
        const [forward, setForward] = useState('');

        const handleChangeInput = (key , value) => {
          setInput(preInput => ({
            ...preInput,
            [key]: value
          }));
        };

        // useEffect(() => {
        //   console.log('loginForm');
        //   fetch('/authSa/shopify', {
        //     method: 'GET',
        //     headers: {
        //       'Content-Type': 'application/json'
        //     },
        //   })
        //     .then(response => response.json())
        //     .then(respData => {
        //       console.log(respData);
        //     });
        // }, []);

        const handleChange = event => {
          const val = event.target.value;
          try {
            const strippedShop = new URL(val).hostname;
            console.log(strippedShop);
            setShopifyURL(strippedShop);
          } catch (e) {
            setShopifyURL(val);
          }
        };


        return (
          <form className="signup-form" action="#">
            <div className="signup-form-header">
              <h2>Sign up</h2>
            </div>
            <div className="signup-form-body">
              <div className="form-group">
                <label htmlFor="provider">Provider</label>
                <input name="dropshipper" type="text" className="form-control" id="provider" placeholder="Dropshipper" disabled />
              </div>
              <div className="form-group">
                <label htmlFor="shopify-url">Shopify Url</label>
                <input name="shopify-url" value={input.shopifyURL}  type="text" className="form-control" id="shopify-url" placeholder="Enter URL" />
              </div>
              <div className="form-group">
                <label htmlFor="username">User Name <span>(from client service platform)</span></label>
                <input name="username" value={input.username} type="text" className="form-control" id="username" placeholder="Enter username" />
              </div>
              <div className="form-group">
                <label htmlFor="password">Password <span>(from client service platform)</span></label>
                <input name="password" value={input.password} type="password" className="form-control" id="password" placeholder="Enter password" />
              </div>
            </div>
            <div className="signup-form-actions">
              <button type="submit" className="singup-action-submit">Sign up</button>
            </div>
          </form>
        );
      }

      const domContainer = document.querySelector('#login-form');
      ReactDOM.render(<LoginForm />, domContainer);
    </script>
  </body>
</html>
